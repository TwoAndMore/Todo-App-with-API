(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var a=n(11),o=(n(20),n(21),n(22),n(1)),c=n.n(o),r=n(2),i=n(4),s=n.n(i),l=n(5),u=n(3),d=n.n(u),f="https://mate.academy/students-api";function j(e){return new Promise((function(t){setTimeout(t,e)}))}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a={method:t};return n&&(a.body=JSON.stringify(n),a.headers={"Content-Type":"application/json; charset=UTF-8"}),j(300).then((function(){return fetch(f+e,a)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var b,h=function(e){return p(e)},m=function(e,t){return p(e,"POST",t)},O=function(e,t){return p(e,"PATCH",t)},x=function(e){return p(e,"DELETE")},v=function(){var e=Object(l.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(l.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,a=t.name,e.abrupt("return",m("/users",{email:n,name:a}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(0),g=function(e){var t=e.onLogin,n=Object(o.useState)(""),a=Object(r.a)(n,2),c=a[0],i=a[1],u=Object(o.useState)(""),f=Object(r.a)(u,2),j=f[0],p=f[1],b=Object(o.useState)(!1),h=Object(r.a)(b,2),m=h[0],O=h[1],x=Object(o.useState)(!1),g=Object(r.a)(x,2),N=g[0],C=g[1],S=Object(o.useState)(""),k=Object(r.a)(S,2),_=k[0],D=k[1],w=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(o.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(a){}}),[]);var E=function(){var e=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(c);case 2:(t=e.sent)?w(t):O(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),D(""),C(!0),e.prev=3,!m){e.next=9;break}return e.next=7,y({name:j,email:c}).then(w);case 7:e.next=11;break;case 9:return e.next=11,E();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),D("Something went wrtong");case 16:return e.prev=16,C(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(T.jsxs)("form",{onSubmit:A,className:"box mt-5",children:[Object(T.jsx)("h1",{className:"title is-3",children:m?"You need to register":"Log in to open todos"}),Object(T.jsxs)("div",{className:"field",children:[Object(T.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(T.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":N}),children:[Object(T.jsx)("input",{type:"email",id:"user-email",className:d()("input",{"is-danger":!m&&_}),placeholder:"Enter your email",disabled:N||m,value:c,required:!0,onChange:function(e){return i(e.target.value)}}),Object(T.jsx)("span",{className:"icon is-small is-left",children:Object(T.jsx)("i",{className:"fas fa-envelope"})})]}),!m&&_&&Object(T.jsx)("p",{className:"help is-danger",children:_})]}),m&&Object(T.jsxs)("div",{className:"field",children:[Object(T.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(T.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":N}),children:[Object(T.jsx)("input",{type:"text",id:"user-name",className:d()("input",{"is-danger":m&&_}),placeholder:"Enter your name",required:!0,minLength:4,disabled:N,value:j,onChange:function(e){return p(e.target.value)}}),Object(T.jsx)("span",{className:"icon is-small is-left",children:Object(T.jsx)("i",{className:"fas fa-user"})})]}),m&&_&&Object(T.jsx)("p",{className:"help is-danger",children:_})]}),Object(T.jsx)("div",{className:"field",children:Object(T.jsx)("button",{type:"submit",className:d()("button is-primary",{"is-loading":N}),children:m?"Register":"Login"})})]})},N=c.a.createContext(null),C=function(e){var t=e.children,n=Object(o.useState)(null),a=Object(r.a)(n,2),c=a[0],i=a[1];return c?Object(T.jsx)(N.Provider,{value:c,children:t}):Object(T.jsx)(g,{onLogin:i})},S=n(8),k=n(6),_=function(e){var t=e.handleCreateTodo,n=e.handleUpdateAllTodosStatus,a=e.todos,c=Object(o.useState)(""),i=Object(r.a)(c,2),s=i[0],l=i[1];return Object(T.jsxs)("header",{className:"todoapp__header",children:[Object(T.jsx)("button",{"data-cy":"ToggleAllButton",type:"button",className:d()("todoapp__toggle-all",{active:a.every((function(e){return e.completed}))}),onClick:n}),Object(T.jsx)("form",{onSubmit:function(e){t(e,s),l("")},children:Object(T.jsx)("input",{"data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?",value:s,onChange:function(e){return l(e.target.value)}})})]})},D=function(e){var t=e.todo,n=e.selectedTodo,a=e.setSelectedTodo,c=e.handleDeleteTodo,i=e.handleUpdateTodoStatus,s=e.handleRenameTodo,l=e.isLoading,u=Object(o.useState)(t.title),f=Object(r.a)(u,2),j=f[0],p=f[1],b=Object(o.useRef)(null),h=(null===n||void 0===n?void 0:n.id)===t.id;Object(o.useEffect)((function(){b.current&&b.current.focus()}),[h]);var m=function(){a(null),s(t,j)};return Object(T.jsxs)("div",{"data-cy":"Todo",className:d()("todo",{completed:t.completed}),children:[Object(T.jsx)("label",{className:"todo__status-label",children:Object(T.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",defaultChecked:!0,onClick:function(){return i(t)}})}),h?Object(T.jsx)("form",{onSubmit:m,children:Object(T.jsx)("input",{"data-cy":"TodoTitleField",type:"text",className:"todo__title-field",placeholder:"Empty todo will be deleted",defaultValue:t.title,onChange:function(e){return p(e.target.value)},onBlur:m,ref:b})}):Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){return a(t)},children:t.title}),Object(T.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){return c(t.id)},children:"\xd7"})]}),Object(T.jsxs)("div",{"data-cy":"TodoLoader",className:d()("modal","overlay",{"is-active":l}),children:[Object(T.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(T.jsx)("div",{className:"loader"})]})]})},w=function(e){var t=e.todos,n=e.handleDeleteTodo,a=e.handleRenameTodo,c=e.handleUpdateTodoStatus,i=e.loadingTodosID,s=Object(o.useState)(null),l=Object(r.a)(s,2),u=l[0],d=l[1];return Object(T.jsx)(T.Fragment,{children:t.map((function(e){return Object(T.jsx)(D,{todo:e,selectedTodo:u,setSelectedTodo:d,handleDeleteTodo:n,handleRenameTodo:a,handleUpdateTodoStatus:c,isLoading:(t=e.id,i.includes(t))},e.id);var t}))})},E=function(e){var t=e.todos,n=e.handleDeleteTodo,a=e.handleRenameTodo,o=e.handleUpdateTodoStatus,c=e.loadingTodosID;return Object(T.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Object(T.jsx)(w,{todos:t,loadingTodosID:c,handleUpdateTodoStatus:o,handleRenameTodo:a,handleDeleteTodo:n})})};!function(e){e[e.All=0]="All",e[e.Active=1]="Active",e[e.Completed=2]="Completed"}(b||(b={}));var A,U=function(e){var t=e.todos,n=e.sortBy,a=e.setSortBy,o=e.handleCompletedTodosClear,c=function(){return t.filter((function(e){return e.completed})).length},r=function(e){return a(e)};return Object(T.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(T.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(t.filter((function(e){return!e.completed})).length," items left")}),Object(T.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(T.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:d()("filter__link",{selected:b.All===n}),onClick:function(){return r(b.All)},children:"All"}),Object(T.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:d()("filter__link",{selected:b.Active===n}),onClick:function(){return r(b.Active)},children:"Active"}),Object(T.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:d()("filter__link",{selected:b.Completed===n}),onClick:function(){return r(b.Completed)},children:"Completed"})]}),Object(T.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",onClick:function(){return o()},style:{opacity:c()>0?"100%":"0%",cursor:c()>0?"pointer":"auto"},children:"Clear completed"})]})},L=function(e,t){return O("/todos/".concat(e),t)};!function(e){e[e.Default=0]="Default",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Update=3]="Update",e[e.WrongTitle=4]="WrongTitle",e[e.Create=5]="Create"}(A||(A={}));var B=function(e){var t=e.isLoading,n=e.todos,a=e.allTodos,c=e.setTodos,i=e.user,u=e.sortBy,d=e.setSortBy,f=e.setErrorType,j=Object(o.useState)([]),p=Object(r.a)(j,2),b=p[0],h=p[1],O=function(e){f(A.Default),h((function(t){return[].concat(Object(k.a)(t),[e])})),function(e){return x("/todos/".concat(e))}(e).then((function(){c((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(){f(A.Delete)}))},v=function(e){f(A.Default),h((function(t){return[].concat(Object(k.a)(t),[e.id])})),L(e.id,{completed:!e.completed}).then((function(){c((function(t){return t.map((function(t){return t.id===e.id?Object(S.a)(Object(S.a)({},t),{},{completed:!t.completed}):t}))}))})).catch((function(){f(A.Update)})).finally((function(){h((function(t){return t.filter((function(t){return t!==e.id}))}))}))},y=function(){var e=Object(l.a)(s.a.mark((function e(t,a){var o,r,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(A.Default),t.preventDefault(),!(a.trim().length<=0)){e.next=5;break}return f(A.WrongTitle),e.abrupt("return");case 5:return o=-n.length,r={id:o,title:a,userId:i.id,completed:!1},c((function(e){return[].concat(Object(k.a)(e),[r])})),h((function(e){return[].concat(Object(k.a)(e),[o])})),e.next=11,(s={title:a,userId:i.id,completed:!1},m("/todos",s)).catch((function(){f(A.Create)}));case 11:l=e.sent,c((function(e){return e.map((function(e){return e.id===o?l:e}))}));case 13:case"end":return e.stop()}var s}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(T.jsxs)("div",{className:"todoapp__content",children:[Object(T.jsx)(_,{todos:n,handleUpdateAllTodosStatus:function(){n.every((function(e){return e.completed}))?n.forEach((function(e){return v(e)})):n.forEach((function(e){!1===e.completed&&v(e)}))},handleCreateTodo:y}),!t&&a.length>0&&Object(T.jsxs)(T.Fragment,{children:[n.length>0&&Object(T.jsx)(E,{todos:n,handleDeleteTodo:O,handleRenameTodo:function(e,t){f(A.Default),e.title!==t&&(t.trim().length<=0?O(e.id):(h((function(t){return[].concat(Object(k.a)(t),[e.id])})),L(e.id,{title:t}).then((function(){c((function(n){return n.map((function(n){return n.id===e.id?Object(S.a)(Object(S.a)({},n),{},{title:t}):n}))}))})).catch((function(){f(A.Update)})).finally((function(){h((function(t){return t.filter((function(t){return t!==e.id}))}))}))))},handleUpdateTodoStatus:v,loadingTodosID:b}),Object(T.jsx)(U,{todos:n,sortBy:u,setSortBy:d,handleCompletedTodosClear:function(){n.filter((function(e){return e.completed})).forEach((function(e){return O(e.id)}))}})]})]})},F=function(e){var t=e.errorType,n=e.setErrorType;Object(o.useEffect)((function(){setTimeout((function(){n(A.Default)}),3e3)}),[]);return Object(T.jsxs)("div",{"data-cy":"ErrorNotification",className:"notification is-danger is-light has-text-weight-normal",children:[Object(T.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return n(A.Default)}}),function(){switch(t){case A.Delete:return"Unable to delete a todo";case A.Add:return"Unable to add a todo";case A.Update:return"Unable to update a todo";case A.WrongTitle:return"Title can't be empty";case A.Create:return"Unable to add a todo";case A.Default:default:return""}}()]})},I=function(){var e=Object(o.useContext)(N),t=Object(o.useState)([]),n=Object(r.a)(t,2),a=n[0],c=n[1],i=Object(o.useState)(!1),s=Object(r.a)(i,2),l=s[0],u=s[1],d=Object(o.useState)(0),f=Object(r.a)(d,2),j=f[0],p=f[1],m=Object(o.useState)(0),O=Object(r.a)(m,2),x=O[0],v=O[1];Object(o.useEffect)((function(){var t;u(!0),e&&(t=e.id,h("/todos?userId=".concat(t))).then(c).finally((function(){return u(!1)}))}),[]);return Object(T.jsxs)("div",{className:"todoapp",children:[Object(T.jsx)("h1",{className:"todoapp__title",children:"todos"}),e&&Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)(B,{isLoading:l,todos:function(){switch(j){case b.Active:return a.filter((function(e){return!e.completed}));case b.Completed:return a.filter((function(e){return e.completed}));case b.All:default:return a}}(),setTodos:c,allTodos:a,user:e,sortBy:j,setSortBy:p,setErrorType:v}),x!==A.Default&&Object(T.jsx)(F,{errorType:x,setErrorType:v})]})]})},R=function(){return Object(T.jsx)(C,{children:Object(T.jsx)(I,{})})};Object(a.createRoot)(document.getElementById("root")).render(Object(T.jsx)(R,{}))}},[[25,1,2]]]);
//# sourceMappingURL=main.5a4ebc81.chunk.js.map